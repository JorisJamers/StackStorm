version: '2.0'

fenego.nginx-demo:
    description: A basic workflow that runs an arbitrary linux command.
    type: direct
    tasks:
        restart_nginx:
            action: core.remote cmd="sudo systemctl start nginx" username="centos" private_key="/home/centos/keys/web.pem" hosts="10.0.32.40"

        status_check:
            action: core.http url="http://10.0.32.40"
            wait-before: 4
            on-success:
                - notify_slack_success
            on-error:
                - notify_slack_error

        notify_slack_success:
            action: slack.chat.postMessage channel="#stackstorm" text="The NGINX webserver just healed perfectly." token="xoxp-278700655542-277831759842-310831064241-9e06e6332dc7a1f490e2a6c189c76a27" username="STACKSTORM"

        notify_slack_error:
            action: slack.chat.postMessage channel="#stackstorm" text="The NGINX webserver needs attention." token="xoxp-278700655542-277831759842-310831064241-9e06e6332dc7a1f490e2a6c189c76a27" username="STACKSTORM"
